!function(require, directRequire){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.scfPutProvisionedConcurrencyConfig=exports.scfGetProvisionedConcurrencyConfig=exports.scfListVersionByFunction=exports.scfPublishVersion=exports.scfGetAlias=exports.scfUpdateAlias=exports.scfGetFunctionLogs=exports.scfInvokeFunction=exports.scfGetFunctionAddress=exports.scfBatchCreateTrigger=exports.scfUpdateFunctionTestModel=exports.scfDeleteFunctionTestModel=exports.scfCreateFunctionTestModel=exports.scfGetFunctionTestModel=exports.scfListFunctionTestModels=exports.scfUpdateFunctionInfo=exports.scfGetFunctionInfo=exports.scfDeleteFunction=exports.scfUpdateFunctionIncrementalCode=exports.scfUpdateFunction=exports.scfCreateFunction=exports.scfListAllFunctions=exports.scfListFunctions=void 0;const tslib_1=require("tslib"),transactor_1=tslib_1.__importDefault(require("../../transaction/transactor")),contracts_1=require("../../transaction/contracts/contracts"),common_1=require("../../utils/common");async function scfListFunctions(e,n){const t={Action:"ListFunctions",Version:"2018-04-16",Region:e.region,Order:e.order,Orderby:e.orderBy,Offset:e.offset,Limit:e.limit,SearchKey:e.searchKey,Namespace:e.namespace,Description:e.description},o=await(0,transactor_1.default)(contracts_1.scfListFunctionsContract,t,n);return{functions:(o.Functions||[]).map(e=>({modTime:(0,common_1.strToDate)(e.ModTime),addTime:(0,common_1.strToDate)(e.AddTime),runtime:e.Runtime,functionName:e.FunctionName,functionId:e.FunctionId,namespace:e.Namespace,status:e.Status,statusDesc:e.StatusDesc,description:e.Description,tags:(e.Tags||[]).map(e=>({key:e.Key,value:e.Value}))})),totalCount:o.TotalCount}}async function scfListAllFunctions(e,n=[],t=0,o){const i=e.limit||100,{functions:s,totalCount:c}=await scfListFunctions({offset:t,limit:i,order:e.order,orderBy:e.orderBy,searchKey:e.searchKey,namespace:e.namespace,description:e.description,region:e.region},o);return c>t+i?scfListAllFunctions(e,[...n,...s],t+i):{functions:[...n,...s],totalCount:c}}async function scfCreateFunction(e,n){const t={Action:"CreateFunction",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,Code:{ZipFile:e.code.zipFile},Handler:e.handler,Description:e.description,MemorySize:e.memorySize,Timeout:e.timeout,Role:e.role,Environment:{Variables:e.environment.variables.map(e=>({Key:e.key,Value:e.value}))},Runtime:e.runtime,Namespace:e.namespace,Stamp:e.stamp,CodeSecret:e.codeSecret,ClsLogsetId:e.clsLogsetId,ClsTopicId:e.clsTopicId};e.hasOwnProperty("installDependency")&&(t.InstallDependency=e.installDependency?"TRUE":"FALSE"),await(0,transactor_1.default)(contracts_1.scfCreateFunctionContract,t,n);return{}}async function scfUpdateFunction(e,n){const t={Action:"UpdateFunctionCode",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,ZipFile:e.fileData,Handler:e.handler||"index.main",Namespace:e.namespace,InstallDependency:e.installDependency?"TRUE":"FALSE",CodeSecret:e.codeSecret};await(0,transactor_1.default)(contracts_1.scfUpdateFunctionContract,t,n);return{}}async function scfUpdateFunctionIncrementalCode(e,n){const t={Action:"UpdateFunctionIncrementalCode",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,Namespace:e.namespace,AddFiles:e.addFiles,DeleteFiles:e.deleteFiles};await(0,transactor_1.default)(contracts_1.scfUpdateFunctionIncrementalCodeContract,t,n);return{}}async function scfDeleteFunction(e,n){const t={Action:"DeleteFunction",Version:"2018-04-16",FunctionName:e.functionName,Namespace:e.namespace,Region:e.region,Qualifier:e.qualifier};await(0,transactor_1.default)(contracts_1.scfDeleteFunctionContract,t,n);return{}}async function scfGetFunctionInfo(e,n){const t={Action:"GetFunction",Version:"2018-04-16",FunctionName:e.functionName,Region:e.region,Qualifier:e.qualifier,Namespace:e.namespace,CodeSecret:e.codeSecret},o=await(0,transactor_1.default)(contracts_1.scfGetFunctionInfoContract,t,n);return{environment:{variables:(o.Environment||{}).Variables.map(e=>({key:e.Key,value:e.Value}))},functionName:o.FunctionName,runtime:o.Runtime,handler:o.Handler,memorySize:o.MemorySize,timeout:o.Timeout,status:o.Status,statusDesc:o.StatusDesc,installDependency:o.InstallDependency,pubnetConfig:"ENABLE"===o.PublicNetConfig.EipConfig.EipStatus,pubnetIp:o.PublicNetConfig.EipConfig.EipAddress}}async function scfUpdateFunctionInfo(e,n){const t={Action:"UpdateFunctionConfiguration",Version:"2018-04-16",FunctionName:e.functionName,Region:e.region,Namespace:e.namespace,Runtime:e.runtime,MemorySize:e.memorySize,Environment:e.environment?{Variables:e.environment.variables.map(e=>({Key:e.key,Value:e.value}))}:void 0,Timeout:e.timeout,ClsLogsetId:e.clsLogsetId,ClsTopicId:e.clsTopicId};e.hasOwnProperty("installDependency")&&(t.InstallDependency=e.installDependency?"TRUE":"FALSE"),e.hasOwnProperty("systemEnvironment")&&(t.SystemEnvironment={Variables:e.systemEnvironment.variables.map(e=>({Key:e.key,Value:e.value}))}),await(0,transactor_1.default)(contracts_1.scfUpdateFunctionInfoContract,t,n);return{}}async function scfListFunctionTestModels(e,n){const t={Action:"ListFunctionTestModels",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,Namespace:e.namespace};return{testModels:(await(0,transactor_1.default)(contracts_1.scfListFunctionTestModelsContract,t,n)).TestModels||[]}}async function scfGetFunctionTestModel(e,n){const t={Action:"GetFunctionTestModel",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,TestModelName:e.testModelName,Namespace:e.namespace},o=await(0,transactor_1.default)(contracts_1.scfGetFunctionTestModelContract,t,n);return{testModelValue:o.TestModelValue,functionName:o.FunctionName,testModelName:o.TestModelName,createdTime:o.CreatedTime,modifiedTime:o.ModifiedTime,namespace:o.Namespace}}async function scfCreateFunctionTestModel(e,n){const t={Action:"CreateFunctionTestModel",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,TestModelName:e.testModelName,TestModelValue:e.testModelValue,Namespace:e.namespace};await(0,transactor_1.default)(contracts_1.scfCreateFunctionTestModelContract,t,n);return{}}async function scfDeleteFunctionTestModel(e,n){const t={Action:"DeleteFunctionTestModel",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,TestModelName:e.testModelName,Namespace:e.namespace};await(0,transactor_1.default)(contracts_1.scfDeleteFunctionTestModelContract,t,n);return{}}async function scfUpdateFunctionTestModel(e,n){const t={Action:"UpdateFunctionTestModel",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,TestModelName:e.testModelName,TestModelValue:e.testModelValue,Namespace:e.namespace};await(0,transactor_1.default)(contracts_1.scfUpdateFunctionTestModelContract,t,n);return{}}async function scfBatchCreateTrigger(e,n){const t={Action:"BatchCreateTrigger",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,Namespace:e.namespace,Triggers:JSON.stringify(e.triggers.map(e=>({TriggerName:e.triggerName,Type:e.type,TriggerDesc:e.triggerDesc}))),Count:e.triggers.length};await(0,transactor_1.default)(contracts_1.scfBatchCreateTriggerContract,t,n);return{}}async function scfGetFunctionAddress(e,n){const t={Action:"GetFunctionAddress",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,Namespace:e.namespace,CodeSecret:e.codeSecret},o=await(0,transactor_1.default)(contracts_1.scfGetFunctionAddressContract,t,n);return{codeSha256:o.CodeSha256,url:o.Url}}async function scfInvokeFunction(e,n){const t={Action:"Invoke",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,Namespace:e.namespace,InvocationType:e.invocationType,Qualifier:e.qualifier,ClientContext:e.clientContext};return{result:{functionRequestId:(await(0,transactor_1.default)(contracts_1.scfInvokeFunctionContract,t,n)).Result.FunctionRequestId}}}async function scfGetFunctionLogs(e,n,t){const o={Action:"GetFunctionLogs",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,Namespace:e.namespace,Offset:e.offset,Limit:e.limit,Order:e.order,OrderBy:e.orderBy,Filter:e.filter?{RetCode:e.filter.retCode}:void 0,Qualifier:e.qualifier,FunctionRequestId:e.functionRequestId,StartTime:e.startTime?(0,common_1.dateToStr)(e.startTime):void 0,EndTime:e.endTime?(0,common_1.dateToStr)(e.endTime):void 0};return{data:(await(0,transactor_1.default)(contracts_1.scfGetFunctionLogsContract,o,Object.assign(Object.assign({},t),{isPoll:n}))).Data.map(e=>({functionName:e.FunctionName,retMsg:e.RetMsg,requestId:e.RequestId,startTime:(0,common_1.strToDate)(e.StartTime),retCode:e.RetCode,invokeFinished:e.InvokeFinished,duration:e.Duration,billDuration:e.BillDuration,memUsage:e.MemUsage,log:e.Log}))}}async function scfUpdateAlias(e){var n,t;const o={Action:"UpdateAlias",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,Name:e.name,FunctionVersion:e.functionVersion,Namespace:e.namespace,RoutingConfig:e.routingConfig?{AdditionalVersionWeights:null===(n=e.routingConfig.additionalVersionWeights)||void 0===n?void 0:n.map(e=>({Version:e.version,Weight:e.weight})),AddtionVersionMatchs:null===(t=e.routingConfig.addtionVersionMatchs)||void 0===t?void 0:t.map(e=>({Version:e.version,Key:e.key,Method:e.method,Expression:e.expression}))}:e.routingConfig,Description:e.description};await(0,transactor_1.default)(contracts_1.scfUpdateAliasContract,o);return{}}async function scfGetAlias(e){var n,t;const o={Action:"GetAlias",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,Name:e.name,Namespace:e.namespace},i=await(0,transactor_1.default)(contracts_1.scfGetAliasContract,o);return{functionVersion:i.FunctionVersion,name:i.Name,routingConfig:{additionalVersionWeights:null===(n=i.RoutingConfig.AdditionalVersionWeights)||void 0===n?void 0:n.map(e=>({version:e.Version,weight:e.Weight})),addtionVersionMatchs:null===(t=i.RoutingConfig.AddtionVersionMatchs)||void 0===t?void 0:t.map(e=>({version:e.Version,key:e.Key,method:e.Method,expression:e.Expression}))},description:i.Description,addTime:i.AddTime,modTime:i.ModTime}}async function scfPublishVersion(e){const n={Action:"PublishVersion",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,Description:e.description,Namespace:e.namespace},t=await(0,transactor_1.default)(contracts_1.scfPublishVersionContract,n);return{functionVersion:t.FunctionVersion,codeSize:t.CodeSize,memorySize:t.MemorySize,description:t.Description,handler:t.Handler,timeout:t.Timeout,runtime:t.Runtime,namespace:t.Namespace}}async function scfListVersionByFunction(e){const n={Action:"ListVersionByFunction",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,Namespace:e.namespace,SearchKey:e.searchKey},t=await(0,transactor_1.default)(contracts_1.scfListVersionByFunctionContract,n);return{functionVersion:t.FunctionVersion,versions:(t.Versions||[]).map(e=>({version:e.Version,description:e.Description,addTime:e.AddTime,modTime:e.ModTime}))}}async function scfGetProvisionedConcurrencyConfig(e){const n={Action:"GetProvisionedConcurrencyConfig",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,Namespace:e.namespace,Qualifier:e.qualifier},t=await(0,transactor_1.default)(contracts_1.scfGetProvisionedConcurrencyConfigContract,n);return{unallocatedConcurrencyNum:t.UnallocatedConcurrencyNum,allocated:t.Allocated.map(e=>({allocatedProvisionedConcurrencyNum:e.AllocatedProvisionedConcurrencyNum,availableProvisionedConcurrencyNum:e.AvailableProvisionedConcurrencyNum,status:e.Status,statusReason:e.StatusReason,qualifier:e.Qualifier}))}}async function scfPutProvisionedConcurrencyConfig(e){var n;const t={Action:"PutProvisionedConcurrencyConfig",Version:"2018-04-16",Region:e.region,FunctionName:e.functionName,Qualifier:e.qualifier,VersionProvisionedConcurrencyNum:e.versionProvisionedConcurrencyNum,Namespace:e.namespace,TriggerActions:null===(n=e.triggerActions)||void 0===n?void 0:n.map(e=>({TriggerName:e.triggerName,TriggerProvisionedConcurrencyNum:e.triggerProvisionedConcurrencyNum,TriggerCronConfig:e.triggerCronConfig,ProvisionedType:e.provisionedType})),ProvisionedType:e.provisionedType,TrackingTarget:e.trackingTarget,MinCapacity:e.minCapacity,MaxCapacity:e.maxCapacity};await(0,transactor_1.default)(contracts_1.scfPutProvisionedConcurrencyConfigContract,t);return{}}exports.scfListFunctions=scfListFunctions,exports.scfListAllFunctions=scfListAllFunctions,exports.scfCreateFunction=scfCreateFunction,exports.scfUpdateFunction=scfUpdateFunction,exports.scfUpdateFunctionIncrementalCode=scfUpdateFunctionIncrementalCode,exports.scfDeleteFunction=scfDeleteFunction,exports.scfGetFunctionInfo=scfGetFunctionInfo,exports.scfUpdateFunctionInfo=scfUpdateFunctionInfo,exports.scfListFunctionTestModels=scfListFunctionTestModels,exports.scfGetFunctionTestModel=scfGetFunctionTestModel,exports.scfCreateFunctionTestModel=scfCreateFunctionTestModel,exports.scfDeleteFunctionTestModel=scfDeleteFunctionTestModel,exports.scfUpdateFunctionTestModel=scfUpdateFunctionTestModel,exports.scfBatchCreateTrigger=scfBatchCreateTrigger,exports.scfGetFunctionAddress=scfGetFunctionAddress,exports.scfInvokeFunction=scfInvokeFunction,exports.scfGetFunctionLogs=scfGetFunctionLogs,exports.scfUpdateAlias=scfUpdateAlias,exports.scfGetAlias=scfGetAlias,exports.scfPublishVersion=scfPublishVersion,exports.scfListVersionByFunction=scfListVersionByFunction,exports.scfGetProvisionedConcurrencyConfig=scfGetProvisionedConcurrencyConfig,exports.scfPutProvisionedConcurrencyConfig=scfPutProvisionedConcurrencyConfig;
}(require("licia/lazyImport")(require), require)